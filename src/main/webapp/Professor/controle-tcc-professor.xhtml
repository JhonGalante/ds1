<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<ui:decorate xmlns="http://www.w3.org/1999/xhtml"
             xmlns:h="http://xmlns.jcp.org/jsf/html"
             xmlns:p="http://primefaces.org/ui"
             template="template-menu.xhtml"
             xmlns:f="http://xmlns.jcp.org/jsf/core"
             xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:body>
        <h:form id="form" enctype="multipart/form-data">
            <p:growl id="msgs" showDetail="true" />
            <p:panel id="controleTcc">
                <p:dataTable id="tabelaControleTcc" var="projeto" value="#{guiAvaliarProjeto.projetos}" selection="#{guiAvaliarProjeto.projetoSelecionado}" rowKey="#{projeto.id}">
                    <f:facet name="header">
                        Projetos Pendentes de Avaliação
                    </f:facet>
                    <p:column selectionMode="single" style="width:16px;text-align:center"/>
                    <p:column headerText="Nome" class="column">
                        <h:outputText value="#{projeto.termoCompromisso.aluno.usuario.nome}" />
                    </p:column>
                    <p:column headerText="Curso" class="column">
                        <h:outputText value="#{projeto.termoCompromisso.aluno.curso}" />
                    </p:column>
                    <p:column headerText="Titulo" class="column">
                        <h:outputText value="#{projeto.termoCompromisso.titulo}" />
                    </p:column>  
                    <p:column headerText="Data de Entrega" class="column">
                        <h:outputText value="#{projeto.dataPublicacao}" />
                    </p:column>  
                    <p:column headerText="Arquivo" class="column">
                        <p:commandButton value="Download" icon="fa fa-fw fa-download" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);">
                            <f:setPropertyActionListener value="#{projeto}" target="#{guiAvaliarProjeto.projetoSelecionado}" />
                            <p:fileDownload value="#{guiAvaliarProjeto.download()}" />
                        </p:commandButton>
                    </p:column>  
                    <f:facet name="footer">
                        <h:outputText value="Selecione um Projeto" />
                        <p:commandButton icon="fa fa-fw fa-hand-o-up" value="Selecionar" style="margin-left: 10px;">
                            <f:ajax execute="j_idt4:form:tabelaAvaliarProjeto" render="j_idt4:form:campoDataAnterior" />
                            <f:ajax execute="j_idt4:form:tabelaAvaliarProjeto" render="j_idt4:form:campoNota" />
                        </p:commandButton>
                    </f:facet>
                </p:dataTable>
                <br/><br/>
                <p:fieldset legend="Movimentar" toggleable="false" collapsed="false">
                    <p:fileUpload value="#{guiControleTCCAluno.file}" mode="simple"/>
                    <h4>Comentários</h4>
                    <p:inputTextarea value="#{guiControleTCCAluno.comentario}" rows="4" cols="30" counter="display" maxlength="5000" counterTemplate="{0} caracteres restantes." autoResize="false" />
                    <br/>
                    <h:outputText id="display" /> 
                    <p:commandButton value="Enviar" ajax="false" action="#{guiControleTCCAluno.realizarUpload()}"/>
                </p:fieldset>
                <br/><br/>
                <p:fieldset legend="Historico" toggleable="true" collapsed="true">
                    <p:panelGrid columns="1" styleClass="ui-fluid">
                        <p:dataTable var="historico" value="#{guiControleTCCAluno.movs}" emptyMessage="Nenhuma movimentação encontrada"
                                     rows="10" paginator="true" paginatorTemplate="{PageLinks}"
                                     paginatorPosition="bottom">

                            <p:column headerText="Data/Hora" sortBy="#{historico.dataHora}">
                                <h:outputText value="#{historico.dataHora}" />
                            </p:column>



                            <p:column headerText="Comentario" sortBy="#{historico.comentario}">
                                <h:outputText value="#{historico.comentario}" />
                            </p:column>

                            <p:column headerText="Tipo de Movimentacao" sortBy="#{historico.tipoMovimentacaoENUM}">
                                <h:outputText value="#{historico.tipoMovimentacaoENUM}" />
                            </p:column>

                            <p:column headerText="Download" style="width:100px;text-align: center">
                                <h:form>
                                    <p:commandButton value="Down" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);">
                                        <f:setPropertyActionListener value="#{historico}" target="#{guiControleTCCAluno.selectedMov}" />
                                        <p:fileDownload value="#{guiControleTCCAluno.realizarDownload()}" />
                                    </p:commandButton>
                                </h:form>
                            </p:column>
                        </p:dataTable>
                    </p:panelGrid>
                </p:fieldset>
            </p:panel>
        </h:form>
    </h:body>
</ui:decorate>